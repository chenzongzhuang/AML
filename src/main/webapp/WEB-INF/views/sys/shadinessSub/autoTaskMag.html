
<!DOCTYPE html>
<html>
<head>
<title>数据包及报文管理</title>


<meta name="keywords" content="keyword1,keyword2,keyword3">
<meta name="description" content="this is my page">
<meta name="content-type" content="text/html; charset=UTF-8">
<link href="${ctxPath}/static/css/bootstrap.min.css" rel="stylesheet" />
<link
	href="${ctxPath}/static/css/plugins/bootstrap-table/bootstrap-table.min.css"
	rel="stylesheet">
<link href="${ctxPath}/static/css/animate.css" rel="stylesheet">
<link href="${ctxPath}/static/css/font-awesome.min.css" rel="stylesheet">
<link rel="stylesheet"
	href="${ctxPath}/static/css/plugins/validate/bootstrapValidator.min.css" />
<link rel="stylesheet" href="${ctxPath}/static/css/style.min.css" />

<link
	href="${ctxPath}/static/css/plugins/jquery-confirm/jquery-confirm.css"
	rel="stylesheet">

<link
	href="${ctxPath}/static/css/plugins/bootstrap-select/bootstrap-select.css"
	rel="stylesheet">
<link href="${ctxPath}/static/css/plugins/select2/select2.css"
	rel="stylesheet">


<link rel="stylesheet"
	href="${ctxPath}/static/css/plugins/acemts/ace-skins.min.css" />
<link href="${ctxPath}/static/css/plugins/datapicker/datepicker3.css"
	rel="stylesheet">


<script src="${ctxPath}/static/jquery/jquery-1.11.3.min.js"
	type="text/javascript"></script>


<script src="${ctxPath}/static/js/jquery.min.js"></script>
<script src="${ctxPath}/static/js/bootstrap.min.js"></script>

<script
	src="${ctxPath}/static/js/plugins/validate/bootstrapValidator.min.js"></script>

<script type="text/javascript" src="js/jquery-ui-custom.min.js"></script>

<script
	src="${ctxPath}/static/js/plugins/bootstrap-table/bootstrap-table.min.js"></script>

<script
	src="${ctxPath}/static/js/plugins/jquery-confirm/jquery-confirm.js"></script>

<script
	src="${ctxPath}/static/js/plugins/bootstrap-select/bootstrap-select.js"></script>

<script src="${ctxPath}/static/js/plugins/select2/select2.min.js"></script>

<script
	src="${ctxPath}/static/js/plugins/datapicker/bootstrap-datepicker.js"></script>

<script src="${ctxPath}/static/js/plugins/fullcalendar/moment.min.js"></script>

<link rel="stylesheet"
	href="${ctxPath}/static/css/plugins/jquery-ui-1.10.3.custom/jquery-ui-1.10.3.custom.min.css" />
<link rel="stylesheet"
	href="${ctxPath}/static/css/plugins/jquery-ui-1.10.3.full/jquery-ui-1.10.3.full.min.css" />

<script
	src="${ctxPath}/static/js/plugins/jquery.ui.touch-punch/jquery.ui.touch-punch.min.js"></script>
<script src="${ctxPath}/static/js/plugins/jquery-ui/jquery-ui.min.js"></script>
<link rel="stylesheet"
	href="${ctxPath}/static/css/plugins/font-awesome/font-awesome.min.css" />
<link rel="stylesheet"
	href="${ctxPath}/static/css/plugins/ace/ace.min.css" />
<link rel="stylesheet"
	href="${ctxPath}/static/css/plugins/ace-rtl/ace-rtl.min.css" />
<link rel="stylesheet"
	href="${ctxPath}/static/css/plugins/acemts/ace-skins.min.css" />

<style>
.back:hover {
	cursor: pointer;
}

.fixed-table-toolbar .btn-group>.btn-group:last-child>.btn {
	border-top-right-radius: 0px;
	border-bottom-right-radius: 0px;
}

label {
	width: 100px;
}

.popup_de {
	background-color: rgba(0, 0, 0, 0.3);
	width: 100%;
	height: 100%;
	position: fixed;
	z-index: 999;
	top: 0;
	left: 0;
	display: none;
}

.bbox {
	display: -webkit-box;
	/* 老版本语法: Safari, iOS, Android browser, older WebKit browsers. */
	display: -moz-box; /* 老版本语法: Firefox (buggy) */
	display: -ms-flexbox; /* 混合版本语法: IE 10 */
	display: -webkit-flex; /* 新版本语法: Chrome 21+ */
	display: -moz-flex;
	display: flex; /* 新版本语法: Opera 12.1, Firefox 22+ */
}

.bbox.xycenter {
	-moz-box-pack: center; /*Firefox*/
	-webkit-box-pack: center; /*Safari,Opera,Chrome*/
	box-pack: center;
	-moz-justify-content: center;
	-webkit-justify-content: center;
	justify-content: center;
	-moz-box-align: center; /*Firefox*/
	-webkit-box-align: center; /*Safari,Opera,Chrome*/
	box-align: center;
	-moz-align-items: center;
	-webkit-align-items: center;
	align-items: center;
}

.popup_de .popup_box {
	width: 300px;
	height: 150px;
	font-family: '微软雅黑';
	background-color: #fff;
	border-radius: 5px;
	color: #333;
}

.popup_de .popup_btn {
	display: inline-block;
	width: 100px;
	height: 30px;
	border-radius: 3px;
	border: 1px solid #1ab394;
	font-size: 15px;
	text-align: center;
	line-height: 30px;
	margin-right: 15px;
	cursor: pointer;
}

.popup_de .show_msg {
	display: block;
	width: 100%;
	text-align: center;
	font-size: 18px;
	margin-top: 40px;
	margin-bottom: 20px;
	padding: 10px;
}

.popup_de .popup_close {
	width: 30px;
	height: 30px;
	font-size: 25px;
	text-align: center;
	display: inline-block;
	cursor: pointer;
	float: right;
	border-top-right-radius: 5px;
	line-height: 30px;
}

.popup_de .popup_close:hover {
	background-color: #1ab394;
	color: #fff;
}

.popup_de .btn_submit {
	background-color: #1ab394;
	color: #fff;
}

.popup_de .btn_box {
	text-align: center;
}
</style>


</head>

<body>

	<div id="tabs">
		<ul>
			<li><a href="#tabs-1">数据包</a></li>

			<li><a href="#tabs-2">报文</a></li>

		</ul>

		<div id="tabs-1" class="tab-pane active">
			<div class="tableBody">
				<div class="panel panel-default">
					<div class="panel-heading">查询条件</div>
					<div class="panel-body form-group" style="margin-bottom:0px;">
						<label class="col-sm-2 control-label"
							style="text-align: right; margin-top:5px">报送日期：</label>

						<div class="col-sm-2">
							<input type="text" class="input-sm form-control mts"
								name="suBDate" id="suBDate" />
						</div>

						<label class="col-sm-2 control-label"
							style="text-align: right; margin-top:5px">数据包类型：</label>

						<div class="col-sm-2">
							<select class="js-states form-control" id="packetType ">
							</select>
						</div>

						<label class="col-sm-2 control-label"
							style="text-align: right; margin-top:5px">数据包名：</label>
						<div class="col-sm-2">

							<input type="text" class="form-control" name="packetName"
								id="packetName" />
						</div>

						<div class="col-sm-2 pull-right">
							<button class="btn btn-primary" id="search_btn">查询</button>
						</div>
					</div>
				</div>
				<table id="mytab" class="table table-hover"></table>
				<div id="toolbar" class="btn-group pull-right columns">
					<button id="btn_1" type="button" class="btn btn-default">
						<span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>回执包导入
					</button>
					<button id="btn_2" type="button" class="btn btn-default">
						<span class="glyphicon glyphicon-remove" aria-hidden="true"></span>重新生成
					</button>
				</div>


				<div id="tabs-2">
					<div class="tableBody">
						<div class="panel panel-default">
							<div class="panel-heading">查询条件</div>
							<div class="panel-body form-group" style="margin-bottom:0px;">
								<label class="col-sm-2 control-label"
									style="text-align: right; margin-top:5px">报送日期：</label>

								<div class="col-sm-2">
									<input type="text" class="input-sm form-control mts"
										name="suBDate" id="suBDateSub" />
								</div>

								<label class="col-sm-2 control-label"
									style="text-align: right; margin-top:5px">数据包类型：</label>

								<div class="col-sm-2">
									<select class="js-states form-control" id="packetTypeSub ">
									</select>
								</div>

								<label class="col-sm-2 control-label"
									style="text-align: right; margin-top:5px">数据包名：</label>
								<div class="col-sm-2">

									<input type="text" class="form-control" name="packetName"
										id="packetNameSub" />
								</div>

								<div class="col-sm-2 pull-right">
									<button class="btn btn-primary" id="search_btnTrd">查询</button>
								</div>
							</div>

						</div>



					</div>
				</div>
				<table id="mytabTrd" class="table table-hover"></table>
				<div id="toolbarTrd" class="btn-group pull-right columns">
					<button id="btn_trd_1" type="button" class="btn btn-default">
						<span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>回执包导入
					</button>
					<button id="btn_trd_2" type="button" class="btn btn-default">
						<span class="glyphicon glyphicon-remove" aria-hidden="true"></span>重新生成
					</button>
				</div>
			</div>
		</div>
	</div>
	<script type="text/javascript">
		$( "#tabs" ).tabs();
		//getLayerLoad("categories","CATEGORIES");
		$(function(){
		$(".mts").datepicker({
            language: "zh-CN",
            autoclose: true,//选中之后自动隐藏日期选择框
            clearBtn: true,//清除按钮
            todayBtn: true,//今日按钮
            format: "yyyy-mm-dd"//日期格式
        });


	//根据窗口调整表格高度
    $(window).resize(function() {
        $("'#mytab").bootstrapTable('resetView', {
            height: tableHeight()
        })
    })
    
    //数据包
    $("#mytab").bootstrapTable({
    	method: 'post',
    	contentType: "application/x-www-form-urlencoded",
    	url:"/earlyWarning/ruler/FindTStanAreaRoll",
    	height:tableHeight(),//高度调整
    	toolbar: "#toolbar",
    	dataType: "json",
    	striped: true, //是否显示行间隔色
    	/* dataField: "res", */
    	pageNumber: 1, //初始化加载第一页，默认第一页
    	pagination:true,//是否分页
    	queryParamsType:"limit",
    	idField: "areaRollId",
    	queryParams:queryParams,
    	sidePagination:"server",
    	pageSize:10,//单页记录数
    	pageList:[5,10,20,30],//分页步进值
    	showRefresh:true	,//刷新按钮
    	showColumns:true,
    	showFooter:true,
    	showPaginationSwitch:true,
    	clickToSelect: true,//是否启用点击选中行
    	toolbarAlign:"right",
    	buttonsAlign:"right",//按钮对齐方式
    	toolbar:"#toolbar",//指定工作栏
        smartDisplay: false,//智能显示分页按钮
   		paginationPreText: "上一页",
    	paginationNextText: "下一页",
    	showToggle:false,                    //是否显示详细视图和列表视图的切换按钮
		cardView: false, 

    	columns:[
        	{
        		title:"全选",
        		field:'select',
        		checkbox:true,
        		width:25,
        		align:'center',
        		valign:'middle'
        	},
        	{field: '序号', title: '序号',
                formatter: function (value, row, index) {
                    return index+1;
            }},
        	{
        		title:"ID",
        		field:"'id'",
        		visible:false
        	},
        	{
        		title:"报送日期",
        		field:"suBDate",
        		sortable:true
        	},
        	{
        		title:"数据包类型",
        		field:"packetType",
        		sortable:true
        	},
        	{
        		title:"批次",
        		field:"mts",
        	},
        	{
        		title:"数据包名",
        		field:"packetName"
        	},
        	{
        		title:"报文数量",
        		field:"packetNum",
	        	sortable:true
        	},
        	{
        		title:"报文状态",
        		field:"subStatus",
        		sortable:true
        	},
        	{
        		title:"生成时间",
        		field:"createDate",
        		sortable:true
        	},
        	{
        		title:"备注",
        		field:"note",
        	}
    	],
    	locale:'zh-CN',//中文支持,
    	formatLoadingMessage: function () {
		    			return "请稍等，正在加载中...";
		    		},
		    		formatNoMatches: function () {  //没有匹配的结果
		    			return "无符合条件的记录";
		    		},
    	responseHandler: function(res) {
			               return {
			                    "total": res.data.records,//总页数
			                    "rows": res.data.rows   //数据
			                 };
		    				
		            },
    })
    
    
    //报文
    $("#mytabTrd").bootstrapTable({
    	method: 'post',
    	contentType: "application/x-www-form-urlencoded",
    	url:"/earlyWarning/ruler/FindTStanAreaRoll",
    	height:tableHeight(),//高度调整
    	toolbar: "#toolbar",
    	dataType: "json",
    	striped: true, //是否显示行间隔色
    	/* dataField: "res", */
    	pageNumber: 1, //初始化加载第一页，默认第一页
    	pagination:true,//是否分页
    	queryParamsType:"limit",
    	idField: "areaRollId",
    	queryParams:queryParams,
    	sidePagination:"server",
    	pageSize:10,//单页记录数
    	pageList:[5,10,20,30],//分页步进值
    	showRefresh:true	,//刷新按钮
    	showColumns:true,
    	showFooter:true,
    	showPaginationSwitch:true,
    	clickToSelect: true,//是否启用点击选中行
    	toolbarAlign:"right",
    	buttonsAlign:"right",//按钮对齐方式
    	toolbar:"#toolbar",//指定工作栏
        smartDisplay: false,//智能显示分页按钮
   		paginationPreText: "上一页",
    	paginationNextText: "下一页",
    	showToggle:false,                    //是否显示详细视图和列表视图的切换按钮
		cardView: false, 

    	columns:[
        	{
        		title:"全选",
        		field:'select',
        		checkbox:true,
        		width:25,
        		align:'center',
        		valign:'middle'
        	},
        	{field: '序号', title: '序号',
                formatter: function (value, row, index) {
                    return index+1;
            }},
        	{
        		title:"ID",
        		field:"'id'",
        		visible:false
        	},
        	{
        		title:"报送日期",
        		field:"suBDate",
        		sortable:true
        	},
        	{
        		title:"数据包类型",
        		field:"packetType",
        		sortable:true
        	},
        	{
        		title:"批次",
        		field:"mts",
        	},
        	{
        		title:"数据包名",
        		field:"packetName"
        	},
        	{
        		title:"报文数量",
        		field:"packetNum",
	        	sortable:true
        	},
        	{
        		title:"报文状态",
        		field:"subStatus",
        		sortable:true
        	},
        	{
        		title:"生成时间",
        		field:"createDate",
        		sortable:true
        	},
        	{
        		title:"备注",
        		field:"note",
        	}
    	],
    	locale:'zh-CN',//中文支持,
    	formatLoadingMessage: function () {
		    			return "请稍等，正在加载中...";
		    		},
		    		formatNoMatches: function () {  //没有匹配的结果
		    			return "无符合条件的记录";
		    		},
    	responseHandler: function(res) {
			               return {
			                    "total": res.data.records,//总页数
			                    "rows": res.data.rows   //数据
			                 };
		    				
		            },
    })
    
   
    
   function operateFormatter(value,row,index){
    	if(value==2){
    		return '<i class="fa fa-lock" style="color:red"></i>'
    	}else if(value==1){
    		return '<i class="fa fa-unlock" style="color:green"></i>'
    	}else{
    		return '数据错误'
    	}
    }


    //请求服务数据时所传参数
    function queryParams(params){
    	return{
    		 rows: params.limit,
    		 page:params.offset+1, 
    		 suBDate:$('#suBDate').val(),
			 packetType:$('#packetType').val(),
			 packetName:$('#packetName').val()
    	}
    }
    
     function queryParam(params){
    	return{
    		 rows: params.limit,
    		 page:params.offset+1, 
    		 rows: params.limit,
    		 page:params.offset+1, 
    		 suBDate:$('#suBDateSub').val(),
			 packetType:$('#packetTypeSub').val(),
			 packetName:$('#packetNameSub').val()
    	}
    }
				
    //查询按钮事件 数据包
    $('#search_btn').click(function(){
    	$("#mytab").bootstrapTable('refresh', {url: "/earlyWarning/ruler/FindTStanAreaRoll"});
    })
    
     //查询按钮事件 报文
    $('#search_btnTrd').click(function(){
    	$("#mytabTrd").bootstrapTable('refresh', {url: "/earlyWarning/ruler/FindTStanAreaRoll"});
    })
    //回执包导入 数据包
    $("#btn_1").on("click", function () {
					$.confirm({
                            title: "回执包导入",
                            content: "回执包导入",
                            icon: 'fa fa-question-circle',
                            animation: 'scale',
                            closeAnimation: 'scale',
                            opacity: 0.5,
                            buttons: {
                                'confirm': {
                                    text: "导入",
                                    btnClass: 'btn-blue',
                                    action: function () {
                                      var rollId=[];
						        	  for(var i=0;i<dataArr.length;i++){
						        		rollId[i]=dataArr[i].idNo+"";
						        	  }
						        	$.post("/earlyWarning/ruler/DeleteTStanAreaRoll",
						        			{idNoList:rollId+""},
						        	function(data){
						        			$('#mytab').bootstrapTable('refresh', {url: "/earlyWarning/ruler/FindTStanAreaRoll"});
						        			$.alert("成功");
						        	});
                                    }
                                },
                                	返回: function () {
                                },
                            }
                          });
					return true;
              });
      //重新生成 报文
      $("#btn_2").on("click", function () {
					$.confirm({
                            title: "重新生成",
                            content: "重新生成",
                            icon: 'fa fa-question-circle',
                            animation: 'scale',
                            closeAnimation: 'scale',
                            opacity: 0.5,
                            buttons: {
                                'confirm': {
                                    text: "生成",
                                    btnClass: 'btn-blue',
                                    action: function () {
                                      var rollId=[];
						        	  for(var i=0;i<dataArr.length;i++){
						        		rollId[i]=dataArr[i].idNo+"";
						        	  }
						        	$.post("/earlyWarning/ruler/DeleteTStanAreaRoll",
						        			{idNoList:rollId+""},
						        	function(data){
						        			$('#mytab').bootstrapTable('refresh', {url: "/earlyWarning/ruler/FindTStanAreaRoll"});
						        			$.alert("成功");
						        	});
                                    }
                                },
                                	返回: function () {
                                },
                            }
                          });
					return true;
              });
              
                //报文 回执包导入
    $("#btn_trd_1").on("click", function () {
					$.confirm({
                            title: "回执包导入",
                            content: "回执包导入",
                            icon: 'fa fa-question-circle',
                            animation: 'scale',
                            closeAnimation: 'scale',
                            opacity: 0.5,
                            buttons: {
                                'confirm': {
                                    text: "导入",
                                    btnClass: 'btn-blue',
                                    action: function () {
                                      var rollId=[];
						        	  for(var i=0;i<dataArr.length;i++){
						        		rollId[i]=dataArr[i].idNo+"";
						        	  }
						        	$.post("/earlyWarning/ruler/DeleteTStanAreaRoll",
						        			{idNoList:rollId+""},
						        	function(data){
						        			$('#mytab').bootstrapTable('refresh', {url: "/earlyWarning/ruler/FindTStanAreaRoll"});
						        			$.alert("成功");
						        	});
                                    }
                                },
                                	返回: function () {
                                },
                            }
                          });
					return true;
              });
              
    
    //报文 重新生成
        $("#btn_trd_2").on("click", function () {
					$.confirm({
                            title: "重新生成",
                            content: "重新生成",
                            icon: 'fa fa-question-circle',
                            animation: 'scale',
                            closeAnimation: 'scale',
                            opacity: 0.5,
                            buttons: {
                                'confirm': {
                                    text: "生成",
                                    btnClass: 'btn-blue',
                                    action: function () {
                                      var rollId=[];
						        	for(var i=0;i<dataArr.length;i++){
						        		rollId[i]=dataArr[i].idNo+"";
						        	}
						        	$.post("/earlyWarning/ruler/DeleteTStanAreaRoll",
						        			{idNoList:rollId+""},
						        	function(data){
						        			$('#mytab').bootstrapTable('refresh', {url: "/earlyWarning/ruler/FindTStanAreaRoll"});
						        			$.alert("成功");
						        	});
                                    }
                                },
                                	返回: function () {
                                },
                            }
                          });
					return true;
              });
              
           
    
    //弹出框取消按钮事件
   　　$('.popup_de .btn_cancel').click(function(){
	   $('.popup_de').removeClass('bbox');
   　　})
    //弹出框关闭按钮事件
     $('.popup_de .popup_close').click(function(){
	   $('.popup_de').removeClass('bbox');
   　　})
   
  	
})
function tableHeight() {
    return $(window).height() - 140;
}
	function getLayerLoad(tcId,lookupType){
			$.ajax({   
				 url:"/tool/ruler/findByType?lookupType="+lookupType,
			     dataType:'json',
			     data:'',
			     jsonp:'callback',
			     async:false,
			     jsonpCallback:"success_jsonpCallback",
			     success:function(data){
			     $("#"+tcId).empty();
			       $("#"+tcId).append("<option></option>");
			     $.each(data.data,function(i,o){
			     var opt="";
			     opt+="<option value='"+o.lookupEn+"'>"+o.lookupDesc+"</option>";
			     $("#"+tcId).append(opt);
			     });
			    },error:function(){
			     }
			});
   }
</script>
	<div style="display:none">
		<script src='${ctxPath}/static/js/plugins/stat/stat.js'
			language='JavaScript' charset='gb2312'></script>
	</div>
</body>
</html>



